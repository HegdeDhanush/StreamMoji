FROM bitnami/spark:3.4.1

# Switch to root to install packages
USER root

# Install additional Python packages
RUN pip install --no-cache-dir \
    kafka-python==2.0.2 \
    python-dotenv==1.0.0

# Create app directory
WORKDIR /app

# Copy the project
COPY . .

# Set Python path
ENV PYTHONPATH=/app:$PYTHONPATH

# Switch back to spark user
USER 1001

# Default command
CMD ["python", "src/spark/processor.py"]